# Problem 8 â€” Permutational Sieve with Residue Restrictions

## Problem Statement

Let $n$ ($3 \leq n \leq 12$) be an integer and $m$ ($2 \leq m \leq 10^6$) a modulus.  
You are given an array $A = [a_1, a_2, \dots, a_n]$ of $n$ distinct positive integers ($1 \leq a_i \leq 10^6$).

Consider all possible **permutations** $P = [p_1, p_2, \dots, p_n]$ of the elements of $A$.  
For each such permutation $P$, compute its **weighted sum residue**:
$$
S_P = \left(\sum_{k=1}^{n} k \cdot p_k \right) \bmod m
$$

Define a family $\mathcal{F}$ of permutations such that:

- For any two distinct $P, Q \in \mathcal{F}$, $S_P \neq S_Q$ (all weighted sum residues under $\bmod m$ are unique).
- For each $P \in \mathcal{F}$, $S_P$ is **not divisible by any of the $a_i$** (that is, $S_P \bmod a_i \neq 0$ for all $i$).

Your task:

- Given $n$, $m$, and $A$, **find the largest possible family $\mathcal{F}$ of permutations satisfying the above**, and **output its size and all permutations in $\mathcal{F}$**.
- Each permutation is given as $n$ space-separated integers.

---

## Input

- First line: $n~m$ ($3 \leq n \leq 12$, $2 \leq m \leq 10^6$)
- Second line: $a_1~a_2~...~a_n$ (distinct, $1 \leq a_i \leq 10^6$)

---

## Output

- First line: integer $f$ (size of family)
- Next $f$ lines: each line is $n$ space-separated integers (a permutation of $A$, as a member of $\mathcal{F}$)

---

## Sample Input

4 12
2 4 5 7



---

## Sample Output

2
4 2 5 7
5 4 2 7



---

### Notes

- Each output permutation must be of the original array (all elements, order matters), and all $S_P$ must be distinct residues mod $m$ and not divisible by any input $a_i$.
- There may be multiple valid maximal families; any maximal solution is accepted.

---

## Constraints

- $3 \leq n \leq 12$
- $2 \leq m \leq 10^6$
- $1 \leq a_i \leq 10^6$ (all $a_i$ distinct)

---

## Extra Sample Test Cases

5 20
3 6 9 11 14

6 48
1 2 3 4 5 6



---

## Further Explanation and Requirements

To solve, you must:

- Consider all possible $n!$ permutations.
- For each, compute $S_P$ and assure all residues chosen are unique.
- Further, each residue must not be divisible by any element of $A$.

---

**End of Problem**
