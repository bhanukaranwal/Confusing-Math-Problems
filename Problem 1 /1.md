# Problem 1 — Algebraic Graph Colorings with Coprime Polynomials

## Problem Statement

You are given a finite, undirected, connected **graph $G=(V,E)$** with $n$ nodes $(1 \leq n \leq 18)$ and $m$ edges $(0 \leq m \leq \binom{n}{2})$. Each node $i$ is assigned a positive integer label $l_i$ $(1 \leq l_i \leq 10^6)$.

Consider all possible **proper colorings** of the graph using $k$ colors $(2 \leq k \leq n)$:

- A coloring is proper if no adjacent nodes share the same color.

Define the **characteristic polynomial** of a coloring $C$ as:

$$
P_C(x) = \prod_{i=1}^{n} (x - l_i^{c_i})
$$

where $c_i$ is the color assigned to node $i$ (an integer in $[1,k]$).

We say two colorings $C$ and $C'$ are **coprime** if $\gcd(P_C(x), P_{C'}(x)) = 1$ as polynomials over the integers.

Let $M(n, m, k)$ be the **maximum possible size of a family $\mathcal{F}$ of proper colorings**, such that every pair of colorings $C_1, C_2 \in \mathcal{F}, C_1 \neq C_2$ are coprime.

**Your task**:

- Given $G$ and labels $l_i$ and fixed $k$, compute the **maximum $M(n, m, k)$** and find one such family $\mathcal{F}$ attaining this size.

Output the size $M(n, m, k)$ and, for each coloring in $\mathcal{F}$, print the coloring as a sequence $(c_1, c_2, ..., c_n)$ (space separated colors per node).

---

## Input

- First line: $n~m~k$ ($2 \leq n \leq 18$, $0 \leq m \leq \binom{n}{2}$, $2 \leq k \leq n$)
- Second line: $l_1~l_2~...~l_n$ (labels for nodes)
- Next $m$ lines: $u~v$ (edges, $1$-indexed)

---

## Output

- First line: integer $M(n,m,k)$
- Next $M(n,m,k)$ lines: each line contains a proper coloring as $c_1~c_2~...~c_n$ (color assignments for nodes $1$ to $n$, $1 \leq c_i \leq k$)

---

## Sample Input
4 3 3
2 3 5 7
1 2
2 3
3 4

---

## Sample Output

2
1 2 3 1
2 1 3 2

---

### Notes

- Two polynomials are coprime if and only if they have no common roots with integer multiplicities.
- For the colorings, you may select any maximum coprime subset. There may be multiple correct outputs.
- For $k=2$ and graphs with high connectivity, the number of proper colorings may be very small.
- For larger $k$, the challenge is both combinatorial (proper coloring enumeration) and algebraic (coprimality of polynomials).

---

## Constraints

- You must **explicitly construct the colorings** (no probabilistic or randomized output).
- The family must be **maximal** in size (not just any solution).
- If multiple maximal families of colorings exist, you may output any one.

---

## Extra Sample Test Cases

5 5 3
2 2 3 3 5
1 2
2 3
3 4
4 5
5 1

3 2 2
4 9 25
1 2
2 3

6 0 2
1 2 3 4 5 6

---

## Further Explanation and Requirements

This problem asks you to combine:

- Hard enumeration (all proper colorings of arbitrary graphs)
- Construction of families with pairwise coprimality under algebraic constraints
- Polynomial arithmetic, factoring, and combinatorics—every coloring yields a nontrivial polynomial with roots determined by $(x - l_i^{c_i})$ per node.

---

**End of Problem**
