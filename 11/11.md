# Problem 11 — Parity-Constrained Orientations and Grundy Sum Games

## Problem Statement

Let $G = (V, E)$ be a simple undirected graph with $n$ nodes ($3 \leq n \leq 16$) and $m$ edges ($2 \leq m \leq n(n-1)/2$).  
Each edge $e$ is assigned a positive integer weight $w_e$ ($1 \leq w_e \leq 10^5$).

Consider all possible orientations of $G$—that is, assign a direction to each undirected edge so it becomes directed (from $u$ to $v$ or $v$ to $u$).

A **valid orientation** must satisfy:

- For every node $v$ in $V$, the number of incoming edges to $v$ is **even**.

Define the **Grundy value** $g(v)$ of node $v$ as the XOR (exclusive or) of the weights of all edges leaving $v$ under the chosen orientation.

Your task:

- Find a valid orientation of $G$ (if one exists) that **maximizes the sum of Grundy values over all nodes**:
  $$
  S = \sum_{v \in V} g(v)
  $$
- Output this maximal sum $S$ and one orientation achieving it (for each edge, print its direction).

---

## Input

- First line: $n~m$ ($3 \leq n \leq 16$, $2 \leq m \leq n(n-1)/2$)
- Next $m$ lines: $u~v~w_e$ (undirected edge between $u$ and $v$, $1$-based indices, and its weight)

---

## Output

- First line: integer $S$ (the maximal sum).
- Next $m$ lines: for each edge (same order as input), print $u~v$ if oriented from $u$ to $v$, or $v~u$ if from $v$ to $u$.

---

## Sample Input

4 5
1 2 7
2 3 3
3 4 5
4 1 6
2 4 2

text

---

## Sample Output

17
1 2
2 3
3 4
4 1
2 4

text

---

### Notes

- Each edge must be oriented; direction must be assigned for all.
- Each node must have an **even number of incoming edges**.
- For each node, the Grundy value is the XOR of all weights of edges going out from it (that node is the source).
- Maximizing the total sum by choosing an appropriate orientation is the challenge.
- There may be multiple optimal orientations; output any maximal one.

---

## Constraints

- $3 \leq n \leq 16$
- $2 \leq m \leq n(n-1)/2$
- $1 \leq w_e \leq 10^5$

---

## Extra Sample Test Cases

5 7
1 2 1
2 3 10
3 4 6
4 5 12
5 1 5
2 4 7
3 5 9

3 3
1 2 8
2 3 13
3 1 4

text

---

## Further Explanation and Requirements

To solve, you must:

- Consider all orientations subject to the parity constraint,
- For each orientation, compute the Grundy value at each node,
- Find and output one that maximizes the required sum.

---

**End of Problem**
