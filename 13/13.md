# Problem 13 â€” Cycle Recurrences on Modular Directed Graphs

## Problem Statement

Let $G = (V, E)$ be a directed graph with $n$ nodes ($3 \leq n \leq 10$) and $m$ edges ($3 \leq m \leq n(n-1)$, no parallel edges).  
Each edge $e$ goes from node $u$ to node $v$ and is assigned a nonzero integer weight $w_e$ ($-10^5 \leq w_e \leq 10^5$, $w_e \ne 0$).

Consider all **cycles** in $G$ (a sequence of nodes $v_1, v_2, ..., v_k, v_1$ with $k \geq 2$ and edges $(v_i, v_{i+1})$ for $1 \leq i < k \leq n$).

For a chosen modulus $M$ ($2 \leq M \leq 10^6$), for every cycle $C$, define its **cycle recurrence value** as follows:

1. Let $W_C = \prod_{e \in C} w_e$ (product of edge weights along the cycle).
2. Let $L_C$ be the length of the cycle.
3. Define $R_C = (W_C + L_C)\bmod M$

Your task:

- Find, among all cycles in $G$, the set of cycles whose $R_C$ are all distinct.
- Output the largest possible set $\mathcal{S}$ of such cycles (no two with the same $R_C$), and for each cycle in $\mathcal{S}$, print its node sequence (starting node first, list of nodes in order forming the cycle, space-separated, using $1$-based indices).

---

## Input

- First line: $n~m~M$ ($3 \leq n \leq 10$, $3 \leq m \leq n(n-1)$, $2 \leq M \leq 10^6$)
- Next $m$ lines: $u~v~w_e$ ($1$-based, directed edge from $u$ to $v$, $w_e$ as specified)

---

## Output

- First line: integer $t$ (size of set $\mathcal{S}$)
- Next $t$ lines: each is the node sequence of a cycle, space-separated, starting and ending at same node, at least two nodes.

---

## Sample Input

4 5 11
1 2 3
2 3 -2
3 1 5
2 4 4
4 1 -3

text

---

## Sample Output

3
1 2 3 1
2 3 1 2
2 4 1 2

text

---

### Notes

- Each cycle is a sequence of nodes, starting and ending at the same node, visiting at least two nodes (length at least 2).
- No cycle in your output may have the same $R_C$ as any other (modulo $M$).
- Orientation/order of cycles matters; do not print the same cycle in two forms.
- There can be multiple valid maximal answers; any maximal collection is accepted.

---

## Constraints

- $3 \leq n \leq 10$
- $3 \leq m \leq n(n-1)$
- $2 \leq M \leq 10^6$
- $-10^5 \leq w_e \leq 10^5$, $w_e \ne 0$

---

## Extra Sample Test Cases

5 7 13
1 2 7
2 3 -2
3 4 5
4 5 6
5 1 -4
3 5 3
2 5 5

3 4 5
1 2 1
2 3 -2
3 1 1
2 1 4

text

---

## Further Explanation and Requirements

You must:

- Enumerate cycles for the graph,
- Compute $R_C$ as specified for each,
- Output the largest set of cycles with pairwise distinct $R_C$.

---

**End of Problem**
